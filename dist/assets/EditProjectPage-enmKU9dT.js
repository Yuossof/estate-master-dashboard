import{r as s,j as e,I as u,a as I,b as se,S as ne,u as le,d as re,C as oe,i as K,k as ie,Q as C,D as O,A as E,W as de}from"./index-DSdmN7-O.js";import{T}from"./Textarea-i9eGARvf.js";import{T as ce}from"./ToggleSelect-BodvaCbc.js";import{P as B}from"./DateRangePicker-DfMR9tZE.js";import{g as me}from"./options-OSOtnHuq.js";const xe=({project:l,setProject:f,handleSubmit:c,errors:t,setErrors:h,isLoading:m})=>{const[x,y]=s.useState(null),[j,N]=s.useState([]),i=o=>{const{name:r,value:d}=o.target;h(g=>({...g,[r]:""})),f(g=>({...g,[r]:d}))},b=o=>{const r=o.target.files?.[0];h(d=>({...d,logo:""})),f(d=>({...d,logo:r||null}))},w=o=>{const r=Array.from(o.target.files||[]);h(d=>({...d,media:""})),f(d=>({...d,media:r}))};return s.useEffect(()=>{if(typeof l?.project_logo=="string"&&l.project_logo){y(l.project_logo);return}if(l?.project_logo instanceof File){const o=URL.createObjectURL(l.project_logo);return y(o),()=>URL.revokeObjectURL(o)}y(null)},[l?.logo]),s.useEffect(()=>{if(Array.isArray(l?.all_media)&&l.all_media.length>0){const o=l.all_media.map(r=>r instanceof File?URL.createObjectURL(r):r);return N(o),()=>{o.forEach(r=>{r.startsWith("blob:")&&URL.revokeObjectURL(r)})}}N([])},[l?.media]),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-5",children:[e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"name",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Name"}),e.jsx(u,{type:"text",placeholder:"Project Name",name:"name",id:"name",value:l.name||"",onChange:i})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"name_ar",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Name Arabic"}),e.jsx(u,{type:"text",placeholder:"Project Name Arabic",name:"name_ar",id:"name_ar",value:l.name_ar||"",onChange:i})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"address",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Address"}),e.jsx(u,{type:"text",placeholder:"Address",name:"address",id:"address",value:l.address||"",onChange:i})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"phone_number",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Phone Number"}),e.jsx(u,{type:"text",placeholder:"Phone number",name:"phone_number",id:"phone_number",value:l.phone_number||"",onChange:i})]}),e.jsx("div",{children:e.jsx(ce,{label:"Active",value:l.active,onChange:o=>f(r=>({...r,active:o}))})}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"whatsapp_number",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"WhatsApp Number"}),e.jsx(u,{type:"text",placeholder:"Whatsapp number",name:"whatsapp_number",id:"whatsapp_number",value:l.whatsapp_number||"",onChange:i})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"unit_count",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Unit Count"}),e.jsx(u,{type:"text",placeholder:"Count",name:"unit_count",id:"unit_count",value:l.unit_count||"",onChange:i})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"starting_from",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Starting From"}),e.jsx(u,{type:"text",placeholder:"Starting From",name:"starting_from",id:"starting_from",value:l.starting_from||"",onChange:i})]})]}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"flex flex-col flex-1 min-w-[150px]",children:[e.jsx("label",{htmlFor:"description",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Description"}),e.jsx(T,{placeholder:"Description",name:"description",id:"description",value:l.description,onChange:i}),t.description&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",t.description]})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-[150px]",children:[e.jsx("label",{htmlFor:"description_ar",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Description Arabic"}),e.jsx(T,{placeholder:"Description Arabic",name:"description_ar",id:"description_ar",value:l.description_ar,onChange:i}),t.description_ar&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",t.description_ar]})]})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"project_logo",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Project Logo"}),e.jsxs("div",{className:"mt-2 flex flex-col items-center",children:[e.jsxs("label",{htmlFor:"project_logo",className:"flex flex-col items-center justify-center w-full h-32 px-3 border-2 border-dashed border-gray-300 dark:border-[var(--border-primary)] rounded-md cursor-pointer hover:border-blue-500 dark:hover:border-sky-400 transition-colors","aria-label":"Upload project logo",children:[x?e.jsx("img",{src:x,alt:"Project Logo",className:"w-20 h-20 object-contain mb-2 border-[1px] border-slate-200 rounded-md bg-white"}):e.jsx(I,{size:40,className:"mb-2 text-gray-400"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-300 text-sm",children:"Upload / Update Logo"})]}),e.jsx("input",{type:"file",name:"project_logo",id:"project_logo",className:"hidden",accept:"image/*",onChange:b})]}),t?.project_logo&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",t.project_logo]})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"media",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Project Media"}),e.jsxs("div",{className:"mt-2 flex flex-col items-center",children:[e.jsx("label",{htmlFor:"all_media",className:"flex flex-col items-center justify-center w-full min-h-[130px] px-3 py-2 border-2 border-dashed border-gray-300 dark:border-[var(--border-primary)] rounded-md cursor-pointer hover:border-blue-500 dark:hover:border-sky-400 transition-colors","aria-label":"Upload media images",children:j.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4  md:grid-cols-6 gap-3 w-full",children:j.map((o,r)=>e.jsx("div",{className:"relative w-full aspect-square rounded-md overflow-hidden border bg-white shadow-sm",children:e.jsx("img",{src:o,alt:`Media ${r+1}`,className:"w-full h-full object-contain p-1"})},r))}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:40,className:"mb-2 text-gray-400"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-300 text-sm",children:"Upload / Update Media"})]})}),e.jsx("input",{type:"file",name:"all_media",id:"all_media",className:"hidden",accept:"image/*",multiple:!0,onChange:w})]}),t?.all_media&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",t.all_media]})]})]}),e.jsxs("div",{className:"mt-6 flex w-full md:justify-end ",children:[e.jsx(se,{}),e.jsxs("button",{disabled:m,style:{opacity:m?"0.6":"1"},type:"button",className:"btn-primary flex items-center gap-3 justify-center h-9 px-3 rounded-md md:w-auto w-full",onClick:c,children:[e.jsx("span",{children:"Update"}),e.jsx(ne,{})]})]})]})},ye=()=>{const l=le(),c=re().state?.rowData||{},[t,h]=s.useState(c),[m,x]=s.useState({}),[y,j]=s.useState(!1),[N,i]=s.useState([]),[b,w]=s.useState(1),[o,r]=s.useState(!0),[d,g]=s.useState(!1),[k,W]=s.useState(""),[F,q]=s.useState(""),[_,z]=s.useState({name:c.name,id:c.company_id}),H=s.useRef(null),[Q,U]=s.useState([]),[S,A]=s.useState(1),[D,$]=s.useState({}),[G,M]=s.useState(!1),[P,J]=s.useState(""),[R,V]=s.useState(""),[X,Y]=s.useState({id:c.city_id}),Z=s.useRef(null);s.useEffect(()=>{const a=setTimeout(()=>{q(k)},350);return()=>clearTimeout(a)},[k]),s.useEffect(()=>{const a=setTimeout(()=>{V(P)},350);return()=>clearTimeout(a)},[P]),s.useEffect(()=>{(async()=>{if(o)try{g(!0);const n=await ie(7,b,F),v=n.data.items||[];(v.length===0||b>=n.data.pagination.totalPages)&&r(!1),i(L=>[...L,...v.map(p=>({id:p.id,name:p.name}))])}catch(n){C.error(n instanceof E?n.errors:O.errors)}finally{g(!1)}})()},[b,F]),s.useEffect(()=>{const a=async()=>{try{M(!0);const n=await me(11,S,_.id,"",R),v=n.data.items||[];U(L=>S===1?v.map(p=>({id:p.id,name:p.item_value})):[...L,...v.map(p=>({id:p.id,name:p.item_value}))]),$(n.data.pagination||{}),console.log("options",n)}catch(n){n instanceof E?C.error(n.errors):C.error(O.errors)}finally{M(!1)}};_.id&&a()},[S,R,_]),s.useEffect(()=>{w(1),i([]),r(!0)},[F]),s.useEffect(()=>{A(1),U([])},[R,t.company_id]);const ee=()=>{o&&w(a=>a+1)},ae=()=>{D&&S<D.totalPages&&A(a=>a+1)},te=async()=>{console.log("pr",t),console.log("company",_),console.log(c,"ex");try{const a=new FormData;a.append("company_id",t.id||""),a.append("name",t.name||""),a.append("name_ar",t.name_ar||""),a.append("address",t.address||""),a.append("whatsapp_number",t.whatsapp_number||""),a.append("phone_number",t.phone_number||""),a.append("description",t.description||""),a.append("description_ar",t.description_ar||""),a.append("city_id",t.city_id||""),a.append("start_date",t.start_date||""),a.append("end_date",t.end_date||""),a.append("active",t.active?1:0),a.append("logo",t.logo),a.append("media",t.media),x({}),j(!0);const n=await de(a,c.id);C.success(n.message||n.massage),n.status==="success"&&l("/options")}catch(a){x(a instanceof E?a.errors:O.errors)}finally{j(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(oe,{children:[e.jsxs("div",{className:"mb-6 pb-4 border-b border-gray-100 dark:border-[var(--border-secondary)]",children:[e.jsx("h1",{className:"md:text-2xl text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Edit Project"}),e.jsx("p",{className:"md:text-base text-[14px] text-gray-500 dark:text-gray-400 mt-1",children:"Update your project details"})]}),e.jsx("div",{className:"flex w-full md:items-center sm:items-end items-center mb-3 md:flex-row flex-col",children:e.jsxs("div",{className:"flex flex-col w-full gap-3  ",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Company"}),e.jsx(K,{searchKeySelect:k,onInputChange:W,onChange:a=>{z(a),x(n=>({...n,company_id:""}))},onEndReached:ee,options:N,value:_?.name||"",isLoading:d,optionBoxRef:H,noResultMessage:"No result"}),e.jsx("div",{className:"h-5",children:m.company_id&&e.jsxs("p",{className:"text-[13px] mt-1.5 text-red-500 ml-1",children:["*",m.company_id]})})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Options"}),e.jsx(K,{searchKeySelect:P,onInputChange:J,onChange:a=>{x(n=>({...n,option_id:""})),Y(a)},onEndReached:ae,options:Q,value:X?.name||"",isLoading:G,optionBoxRef:Z,noResultMessage:t.company_id?"No result":"Select company first"}),e.jsx("div",{className:"h-5",children:m.option_id&&e.jsxs("p",{className:"text-[13px] text-red-500 ml-1",children:["*",m.option_id]})})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(B,{onChange:a=>h(n=>({...n,start_date:a})),value:t.start_date||null,label:"Start Date"}),e.jsx(B,{onChange:a=>h(n=>({...n,end_date:a})),value:t.end_date||null,label:"End Date"})]})})]})}),e.jsx(xe,{project:t,setProject:h,errors:m,setErrors:x,handleSubmit:te,isLoading:y})]})})};export{ye as default};
