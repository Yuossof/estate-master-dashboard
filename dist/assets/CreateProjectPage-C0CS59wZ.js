import{r as s,j as e,I as j,a as W,P as le,h as oe,u as ie,C as de,i as z,k as ce,A as L,Q as h,D as q,V as me}from"./index-DSdmN7-O.js";import{g as xe}from"./options-OSOtnHuq.js";import{T as H}from"./Textarea-i9eGARvf.js";import{T as pe}from"./ToggleSelect-BodvaCbc.js";import{P as Q}from"./DateRangePicker-DfMR9tZE.js";const ue=({projectData:t,setProjectData:p,handleSubmit:o,errors:c,setErrors:g,isLoading:f})=>{const[v,u]=s.useState(null),[N,y]=s.useState([]),m=n=>{const{name:r,value:i}=n.target;g(d=>({...d,[r]:""})),p(d=>({...d,[r]:i}))},_=n=>{const r=n.target.files?.[0];g(i=>({...i,logo:""})),p(i=>({...i,logo:r||null}))},S=n=>{const r=Array.from(n.target.files||[]);g(i=>({...i,media:""})),p(i=>({...i,media:r}))};return s.useEffect(()=>{if(typeof t?.logo=="string"&&t.logo){u(t.logo);return}if(t?.logo instanceof File){const n=URL.createObjectURL(t.logo);return u(n),()=>URL.revokeObjectURL(n)}u(null)},[t?.logo]),s.useEffect(()=>{if(Array.isArray(t?.media)&&t.media.length>0){const n=t.media.map(r=>r instanceof File?URL.createObjectURL(r):r);return y(n),()=>{n.forEach(r=>{r.startsWith("blob:")&&URL.revokeObjectURL(r)})}}y([])},[t?.media]),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-5",children:[e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"name",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Name"}),e.jsx(j,{type:"text",placeholder:"Project Name",name:"name",id:"name",value:t.name||"",onChange:m})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"name_ar",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Name Arabic"}),e.jsx(j,{type:"text",placeholder:"Project Name Arabic",name:"name_ar",id:"name_ar",value:t.name_ar||"",onChange:m})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"name_ar",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Address"}),e.jsx(j,{type:"text",placeholder:"Address",name:"address",id:"address",value:t.address||"",onChange:m})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"whatsapp_number",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Phone Number"}),e.jsx(j,{type:"text",placeholder:"Phone number",name:"phone_number",id:"phone_number",value:t.phone_number||"",onChange:m})]}),e.jsx("div",{children:e.jsx(pe,{label:"Active",value:t.active,onChange:n=>p(r=>({...r,active:n}))})}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"whatsapp_number",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"WhatsApp Number"}),e.jsx(j,{type:"text",placeholder:"Whatsapp number",name:"whatsapp_number",id:"whatsapp_number",value:t.whatsapp_number||"",onChange:m})]})]}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"flex flex-col flex-1 min-w-[150px]",children:[e.jsx("label",{htmlFor:"description",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Description"}),e.jsx(H,{placeholder:"Description",name:"description",id:"description",value:t.description,onChange:m}),c.description&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",c.description]})]}),e.jsxs("div",{className:"flex flex-col flex-1 min-w-[150px]",children:[e.jsx("label",{htmlFor:"description_ar",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Description"}),e.jsx(H,{placeholder:"Description Arabic",name:"description_ar",id:"description_ar",value:t.description_ar,onChange:m}),c.description&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",c.description]})]})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"project_logo",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Project Logo"}),e.jsxs("div",{className:"mt-2 flex flex-col items-center",children:[e.jsxs("label",{htmlFor:"project_logo",className:"flex flex-col items-center justify-center w-full h-32 px-3 border-2 border-dashed border-gray-300 dark:border-[var(--border-primary)] rounded-md cursor-pointer hover:border-blue-500 dark:hover:border-sky-400 transition-colors","aria-label":"Upload project logo",children:[v?e.jsx("img",{src:v,alt:"Project Logo",className:"w-20 h-20 object-contain mb-2 border-[1px] border-slate-200 rounded-md bg-white"}):e.jsx(W,{size:40,className:"mb-2 text-gray-400"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-300 text-sm",children:"Upload / Update Logo"})]}),e.jsx("input",{type:"file",name:"project_logo",id:"project_logo",className:"hidden",accept:"image/*",onChange:_})]}),c?.project_logo&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",c.project_logo]})]}),e.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[e.jsx("label",{htmlFor:"media",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Project Media"}),e.jsxs("div",{className:"mt-2 flex flex-col items-center",children:[e.jsx("label",{htmlFor:"all_media",className:"flex flex-col items-center justify-center w-full min-h-[130px] px-3 py-2 border-2 border-dashed border-gray-300 dark:border-[var(--border-primary)] rounded-md cursor-pointer hover:border-blue-500 dark:hover:border-sky-400 transition-colors","aria-label":"Upload media images",children:N.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4  md:grid-cols-6 gap-3 w-full",children:N.map((n,r)=>e.jsx("div",{className:"relative w-full aspect-square rounded-md overflow-hidden border bg-white shadow-sm",children:e.jsx("img",{src:n,alt:`Media ${r+1}`,className:"w-full h-full object-contain p-1"})},r))}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:40,className:"mb-2 text-gray-400"}),e.jsx("span",{className:"text-gray-500 dark:text-gray-300 text-sm",children:"Upload / Update Media"})]})}),e.jsx("input",{type:"file",name:"all_media",id:"all_media",className:"hidden",accept:"image/*",multiple:!0,onChange:S})]}),c?.all_media&&e.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",c.all_media]})]})]}),e.jsx("div",{className:"mt-6 flex w-full md:justify-end",children:e.jsxs("button",{disabled:f,style:{opacity:f?"0.6":"1"},type:"button",className:"btn-primary flex items-center gap-3 justify-center h-10 px-3 rounded-md md:w-auto w-full",onClick:o,children:[e.jsx("span",{children:"Create"}),e.jsx(le,{})]})})]})},he={company_id:"",name:"",name_ar:"",address:"",whatsapp_number:"",phone_number:"",description:"",description_ar:"",unit_count:"",city_id:"",active:!1,logo:null,media:[]},ve=()=>{const{user:t}=oe(),p=ie(),[o,c]=s.useState(he),[g,f]=s.useState(!1),[v,u]=s.useState({}),[N,y]=s.useState([]),[m,_]=s.useState(!0),[S,n]=s.useState(!1),[r,i]=s.useState(1),[d,V]=s.useState({}),[C,$]=s.useState(""),[P,G]=s.useState(""),J=s.useRef(null),[X,A]=s.useState([]),[w,E]=s.useState(1),[U,Y]=s.useState({}),[k,Z]=s.useState({}),[M,K]=s.useState(!1),[R,D]=s.useState(""),[F,ee]=s.useState(""),ae=s.useRef(null),[I,se]=s.useState(null),[T,te]=s.useState(null);s.useEffect(()=>{(async()=>{if(m)try{n(!0);const l=await ce(10,r,P),b=l.data.items||[];(b.length===0||r>=l.data.pagination.totalPages)&&_(!1),y(O=>[...O,...b.map(x=>({id:x.id,name:x.name}))])}catch(l){l instanceof L?h.error(l.errors):h.error(q.errors)}finally{n(!1)}})()},[r,P]),s.useEffect(()=>{const a=async()=>{try{K(!0);const l=await xe(11,w,d.id,"",F),b=l.data.items||[];A(O=>w===1?b.map(x=>({id:x.id,name:x.item_value})):[...O,...b.map(x=>({id:x.id,name:x.item_value}))]),Y(l.data.pagination||{})}catch(l){l instanceof L?h.error(l.errors):h.error(q.errors)}finally{K(!1)}};d.id&&a()},[w,F,d]),s.useEffect(()=>{const a=setTimeout(()=>{G(C)},350);return()=>{clearTimeout(a)}},[C]),s.useEffect(()=>{i(1),y([]),_(!0)},[P]),s.useEffect(()=>{const a=setTimeout(()=>{ee(R)},350);return()=>{clearTimeout(a)}},[R]),s.useEffect(()=>{E(1),A([])},[F,d]);const B=()=>{m&&i(a=>a+1)},re=()=>{U&&w<U.totalPages&&E(a=>a+1)},ne=async()=>{console.log("------------------------------------------"),console.log(d),console.log("------------------------------------------"),console.log(k),console.log("------------------------------------------"),console.log(o),console.log("------------------------------------------");try{const a=new FormData;if(a.append("company_id",d.id),a.append("name",o.name),a.append("name_ar",o.name_ar),a.append("address",o.address),a.append("whatsapp_number",o.whatsapp_number),a.append("phone_number",o.phone_number),a.append("description",o.description),a.append("description_ar",o.description_ar),a.append("city_id",k.id),a.append("start_date",I),a.append("end_date",T),a.append("logo",o.logo),a.append("media",o.media),a.append("active",1),!t||!t.id){p("/login");return}a.append("created_by",t.id),u({}),f(!0);const l=await me(a);h.success(l.message||l.massage),p("/projects")}catch(a){if(a instanceof L){u(a.errors);const l=Object.keys(a.errors)[0];h.error(a.errors[l][0])}}finally{f(!1)}};return e.jsx("div",{className:"space-y-6",children:e.jsxs(de,{children:[e.jsxs("div",{className:"mb-6 pb-4 border-b border-gray-100 dark:border-[var(--border-secondary)]",children:[e.jsx("h1",{className:"md:text-2xl text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Create Project"}),e.jsx("p",{className:"md:text-base text-[14px] text-gray-500 dark:text-gray-400 mt-1",children:"Add a new project"})]}),e.jsx("div",{className:"flex w-full md:items-center sm:items-end items-center mb-8 md:flex-row flex-col",children:e.jsxs("div",{className:"flex flex-col w-full gap-5",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 md:flex-row flex-col md:w-auto w-full",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"clientName",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Company"}),e.jsx(z,{searchKeySelect:C,onInputChange:a=>$(a),onChange:a=>V(a),onEndReached:B,options:N,value:d.name,isLoading:S,optionBoxRef:J,noResultMessage:"No result"})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"clientName",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Options"}),e.jsx(z,{searchKeySelect:R,onInputChange:a=>D(a),onChange:a=>Z(a),onEndReached:B,options:X,value:k.name,isLoading:M,optionBoxRef:ae,noResultMessage:d.id?"No result":"Select company first"})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(Q,{onChange:a=>se(a),value:I,label:"Start Date"}),e.jsx(Q,{onChange:a=>te(a),value:T,label:"End Date"})]})})]})}),e.jsx(ue,{projectData:o,setProjectData:c,errors:v,setErrors:u,handleSubmit:ne,isLoading:g,loadMoreOptions:re,isFetchOptionsLoading:M})]})})};export{ve as default};
