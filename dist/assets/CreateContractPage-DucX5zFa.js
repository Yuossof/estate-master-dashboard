import{j as a,I as Ce,P as je,h as be,u as ve,r as t,C as we,i as D,k as Ne,A as S,Q as r,D as C,l as Re,m as Ae}from"./index-DSdmN7-O.js";import{P as X}from"./DateRangePicker-DfMR9tZE.js";import{g as Ue}from"./company-users-88HzjCM-.js";const Ee=({contractData:j,setContractData:f,handleSubmit:x,errors:p,setErrors:b,isLoading:u})=>{const v=m=>{const{name:h,value:g}=m.target;b(l=>({...l,[h]:""})),f(l=>({...l,[h]:g}))};return a.jsxs("div",{className:"mt-6",children:[a.jsx("div",{className:"flex flex-col gap-4",children:a.jsx("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-4",children:a.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[a.jsx("label",{htmlFor:"name",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Amount"}),a.jsx(Ce,{type:"text",placeholder:"Amount",name:"amount",id:"amount",value:j.amount,onChange:v}),p.amount&&a.jsxs("p",{className:"text-[13px] text-red-500 mt-2 ml-1",children:["*",p.amount[0]]})]})})}),a.jsx("div",{className:"mt-6 flex w-full md:justify-end",children:a.jsxs("button",{disabled:u,style:{opacity:u?"0.6":"1"},type:"button",className:"btn-primary flex items-center gap-3 justify-center h-10 px-3 rounded-md md:w-auto w-full",onClick:x,children:[a.jsx("span",{children:"Create"}),a.jsx(je,{})]})})]})},Pe={unit_id:"",account_id:"",contract_number:"",title:"",description:"",start_date:"",end_date:"",amount:"",status:"",terms_conditions:"",active:!1},_e=()=>{const{user:j}=be(),f=ve(),[x,p]=t.useState(Pe),[b,u]=t.useState(!1),[v,m]=t.useState({}),[h,g]=t.useState([]),[l,F]=t.useState(!0),[Y,_]=t.useState(!1),[w,L]=t.useState(1),[c,Z]=t.useState({}),[N,ee]=t.useState(""),[R,te]=t.useState(""),ae=t.useRef(null),[se,k]=t.useState([]),[I,M]=t.useState(!0),[ne,T]=t.useState(!1),[A,B]=t.useState(1),[$,oe]=t.useState({}),[U,re]=t.useState(""),[E,ce]=t.useState(""),le=t.useRef(null),[ie,O]=t.useState([]),[y,H]=t.useState(1),[Q,de]=t.useState({}),[q,ue]=t.useState({}),[z,G]=t.useState(!1),[P,me]=t.useState(""),[K,fe]=t.useState(""),xe=t.useRef(null),[J,pe]=t.useState(null),[V,he]=t.useState(null);t.useEffect(()=>{const e=new AbortController;return(async()=>{if(l)try{_(!0);const o=await Ne(10,w,R,e.signal),i=o?.data?.items||[];(i.length===0||w>=(o?.data?.pagination?.totalPages||0))&&F(!1),g(s=>[...s,...i.filter(d=>d&&d.id).map(d=>({id:d.id,name:d.name||`Company ${d.id}`}))])}catch(o){o instanceof S?r.error(o.errors):r.error(C.errors)}finally{_(!1)}})(),()=>e.abort()},[w,R]),t.useEffect(()=>{const e=async()=>{if(!(!I||!c?.id))try{T(!0);const n=await Re(10,A,E,c.id),o=n?.data?.items||[];(o.length===0||A>=(n?.data?.pagination?.totalPages||0))&&M(!1),k(i=>[...i,...o.filter(s=>s&&s.id).map(s=>({id:s.id,name:s.name||`Unit ${s.id}`}))])}catch(n){n instanceof S?r.error(n.errors):r.error(C.errors)}finally{T(!1)}};c?.id&&e()},[A,E,c]),t.useEffect(()=>{(async()=>{try{G(!0);const n=await Ue(10,y,K,""),o=n?.data?.items||[];O(i=>y===1?o.filter(s=>s&&s.id).map(s=>({id:s.id,name:s?.user?.email||s?.company?.name||s?.name||`User ${s.id}`})):[...i,...o.filter(s=>s&&s.id).map(s=>({id:s.id,name:s?.user?.email||s?.company?.name||s?.name||`User ${s.id}`}))]),de(n?.data?.pagination||{})}catch(n){n instanceof S?r.error(n.errors):r.error(C.errors)}finally{G(!1)}})()},[y,K]),t.useEffect(()=>{const e=setTimeout(()=>{te(N)},350);return()=>{clearTimeout(e)}},[N]),t.useEffect(()=>{L(1),g([]),F(!0)},[R]),t.useEffect(()=>{const e=setTimeout(()=>{ce(U)},350);return()=>{clearTimeout(e)}},[U]),t.useEffect(()=>{B(1),k([]),M(!0)},[E,c]),t.useEffect(()=>{const e=setTimeout(()=>{fe(P)},350);return()=>{clearTimeout(e)}},[P]),t.useEffect(()=>{H(1),O([])},[K]);const ge=()=>{l&&L(e=>e+1)},ye=()=>{I&&B(e=>e+1)},W=()=>{Q&&y<(Q.totalPages||0)&&H(e=>e+1)},Se=async()=>{try{const e=new FormData;if(e.append("unit_id",$?.id||""),e.append("company_user_id",q?.id||""),e.append("start_date",J||""),e.append("end_date",V||""),e.append("amount",x?.amount||""),!j?.id){f("/login");return}m({}),u(!0);const n=await Ae(e);r.success(n?.message||n?.massage||"Contract created successfully"),f("/contracts")}catch(e){if(e instanceof S){m(e.errors||{});const n=Object.keys(e.errors||{})[0];n&&e.errors[n]?.[0]&&r.error(e.errors[n][0])}else r.error(C.errors)}finally{u(!1)}};return a.jsx("div",{className:"space-y-6",children:a.jsxs(we,{children:[a.jsxs("div",{className:"mb-6 pb-4 border-b border-gray-100 dark:border-[var(--border-secondary)]",children:[a.jsx("h1",{className:"md:text-2xl text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Create Contract"}),a.jsx("p",{className:"md:text-base text-[14px] text-gray-500 dark:text-gray-400 mt-1",children:"Add a new contract"})]}),a.jsx("div",{className:"flex w-full md:items-center sm:items-end items-center mb-8 md:flex-row flex-col",children:a.jsxs("div",{className:"flex flex-col w-full gap-5",children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 md:flex-row flex-col md:w-auto w-full",children:[a.jsxs("div",{className:"w-full",children:[a.jsx("label",{htmlFor:"company",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Company"}),a.jsx(D,{searchKeySelect:N,onInputChange:e=>ee(e||""),onChange:e=>Z(e||{}),onEndReached:ge,options:h,value:c?.name||"",isLoading:Y,optionBoxRef:ae,noResultMessage:"No result"})]}),a.jsxs("div",{className:"w-full",children:[a.jsx("label",{htmlFor:"unit",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Unit"}),a.jsx(D,{searchKeySelect:U,onInputChange:e=>re(e||""),onChange:e=>oe(e||{}),onEndReached:ye,options:se,value:$?.name||"",isLoading:ne,optionBoxRef:le,noResultMessage:c?.id?"No result":"Select company first"})]}),a.jsxs("div",{className:"w-full",children:[a.jsx("label",{htmlFor:"account",className:"px-1 text-sm font-medium text-gray-700 dark:text-gray-200",children:"Company User"}),a.jsx(D,{searchKeySelect:P,onInputChange:e=>me(e||""),onChange:e=>ue(e||{}),onEndReached:W,options:ie,value:q?.name||"",isLoading:z,optionBoxRef:xe,noResultMessage:"No result"})]})]}),a.jsx("div",{children:a.jsxs("div",{className:"flex items-center gap-5",children:[a.jsx(X,{onChange:e=>pe(e),value:J,label:"Start Date"}),a.jsx(X,{onChange:e=>he(e),value:V,label:"End Date"})]})})]})}),a.jsx(Ee,{contractData:x,setContractData:p,errors:v,setErrors:m,handleSubmit:Se,isLoading:b,loadMoreAccounts:W,isFetchAccountLoading:z})]})})};export{_e as default};
